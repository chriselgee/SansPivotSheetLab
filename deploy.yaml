preconfig:
  [
    "rm ./assets/website.tar.gz",
    "cd assets && tar -czvf website.tar.gz website"
  ]

aws:
  profile: hammer-deploy
  region: us-east-2

tags:
  project: artifact-gen

hosts: [webserver, clients, attacker]

iam:
  name: hammer-user8675309

bucket:
  name: hammer-bucket8675309
  policy: {"Version": "2012-10-17",
      "Statement": [{
        "Sid": "AddPerm",
        "Effect": "Allow",
        "Principal": PRINCIPAL_NAME,
        "Action": ["s3:GetObject", "s3:PutObject"],
        "Resource": "arn:aws:s3:::BUCKET_NAME/*"
      }]
    }
  uploadDir: assets/
  upload: [website.tar.gz,
    userAgents.txt,
    webattacker.py,
    webattacker.service,
    webclient.py,
    webclient.service,
    webserve.service,
    urls.txt,
    passwords.txt,
    users.txt,
    dirb.txt]

webserver:
  ami: ami-07f84a50d2dec2fa4
  count: 1
  download: [website.tar.gz,
    webserve.service]
  host: www.toteslegit.us
  name: WebServer
  size: t2.micro
  userdata: |
    #!/bin/bash
    whoami > /tmp/who.txt
    apt update
    apt -y install nmap ncat python3 python3-pip net-tools awscli tcpdump awscli
    python3 -m pip install flask icecream lxml
    aws configure --profile default set aws_access_key_id AWSACCESSKEYID
    aws configure --profile default set aws_secret_access_key SECRETACCESSKEY
    aws configure --profile default set region REGION
    aws sts get-caller-identity > /tmp/awsident.txt
    aws s3 cp s3://BUCKETNAME/website.tar.gz /opt
    aws s3 cp s3://BUCKETNAME/webserve.service /etc/systemd/system/
    tar -xvf /opt/website.tar.gz -C /opt
    chown -R www-data: /opt/website
    iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8000
    systemctl enable webserve.service
    systemctl start webserve.service

clients:
  ami: ami-07f84a50d2dec2fa4
  count: 20
  download: [urls.txt,
    userAgents.txt,
    webclient.py,
    webclient.service]
  name: WebClients
  size: t2.micro
  userdata: |
    #!/bin/bash
    whoami > /tmp/who.txt
    apt update
    apt -y install nmap ncat python3 python3-pip net-tools awscli
    aws configure --profile default set aws_access_key_id AWSACCESSKEYID
    aws configure --profile default set aws_secret_access_key SECRETACCESSKEY
    aws configure --profile default set region REGION
    aws sts get-caller-identity > /tmp/awsident.txt
    aws s3 cp s3://BUCKETNAME/urls.txt /opt
    aws s3 cp s3://BUCKETNAME/userAgents.txt /opt
    aws s3 cp s3://BUCKETNAME/webclient.py /opt
    aws s3 cp s3://BUCKETNAME/webclient.service /etc/systemd/system/
    systemctl enable webclient.service
    systemctl start webclient.service

attacker:
  ami: ami-07f84a50d2dec2fa4
  count: 1
  download: [webattacker.py,
    webattacker.service,
    urls.txt,
    userAgents.txt]
  name: Attacker
  size: t2.micro
  userdata: |
    #!/bin/bash
    whoami > /tmp/who.txt
    apt update
    apt -y install nmap ncat python3 python3-pip net-tools awscli
    pip3 install icecream
    aws configure --profile default set aws_access_key_id AWSACCESSKEYID
    aws configure --profile default set aws_secret_access_key SECRETACCESSKEY
    aws configure --profile default set region REGION
    aws sts get-caller-identity > /tmp/awsident.txt
    aws s3 cp s3://BUCKETNAME/urls.txt /opt
    aws s3 cp s3://BUCKETNAME/userAgents.txt /opt
    aws s3 cp s3://BUCKETNAME/webattacker.py /opt
    aws s3 cp s3://BUCKETNAME/dirb.txt /opt
    aws s3 cp s3://BUCKETNAME/users.txt /opt
    aws s3 cp s3://BUCKETNAME/passwords.txt /opt
    aws s3 cp s3://BUCKETNAME/webattacker.service /etc/systemd/system
    systemctl enable webattacker.service
    systemctl start webattacker.service
    echo "Hacking for cash monies!" > /opt/secrets.txt

keypair:
  name: hammer-keypair

vpc:
  net: 10.12.0.0/16

subnet:
  net: 10.12.42.0/24

sg:
  name: hammer-sg
  desc: These are not the hammer
  ingress:
    proto: tcp
    fromPort: 22
    toPort: 8000
  egress:
    proto: tcp
    fromPort: 0
    toPort: 65535
